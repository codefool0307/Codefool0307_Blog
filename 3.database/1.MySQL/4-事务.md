<!--
 * @Author: your name
 * @Date: 2020-05-05 16:26:30
 * @LastEditTime: 2020-05-05 16:26:30
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: \docs\3.database\1.MySQL\4-事务.md
 -->
# 4.事务
## 4.1 事务概念

	一个事务是由一条或者多条sql语句构成，这一条或者多条sql语句要么全部执行成功，要么全部执行失败！
	默认情况下，每条单独的sql语句就是一个单独的事务！
举例：
银行转账！张三转10000块到李四的账户，这其实需要两条SQL语句：
    - 给张三的账户减去10000元；
	- 给李四的账户加上10000元。
如果在第一条SQL语句执行成功后，在执行第二条SQL语句之前，程序被中断了（可能是抛出了某个异常，也可能是其他什么原因），那么李四的账户没有加上10000元，而张三却减去了10000元。这肯定是不行的！
你现在可能已经知道什么是事务了吧！事务中的多个操作，要么完全成功，要么完全失败！不可能存在成功一半的情况！也就是说给张三的账户减去10000元如果成功了，那么给李四的账户加上10000元的操作也必须是成功的；否则给张三减去10000元，以及给李四加上10000元都是失败的！

## 4.2 事务的四大特性

原子性（Atomicity）：事务中所有操作是不可再分割的原子单位。事务中所有操作要么全部执行成功，要么全部执行失败。

一致性（Consistency）：事务执行后，数据库状态与其它业务规则保持一致。如转账业务，无论事务执行成功与否，参与转账的两个账号余额之和应该是不变的。

隔离性（Isolation）：隔离性是指在并发操作中，不同事务之间应该隔离开来，使每个并发中的事务不会相互干扰。

持久性（Durability）：一旦事务提交成功，事务中所有的数据操作都必须被持久化到数据库中，即使提交事务后，数据库马上崩溃，在数据库重启时，也必须能保证通过某种机制恢复数据。


## 4.3 分类：

1. 隐式事务：没有明显的开启和结束标记
   
	比如dml语句的insert、update、delete语句本身就是一条事务
	
	insert into stuinfo values(1,'john','男','ert@dd.com',12);
	
2. 显式事务：具有明显的开启和结束标记

	一般由多条sql语句组成，必须具有明显的开启和结束标记
	
3. 步骤：
	0、取消隐式事务自动开启的功能
	
	1、开启事务

	2、编写事务需要的sql语句（1条或多条）

		insert into stuinfo values(1,'john','男','ert@dd.com',12);

		insert into stuinfo values(1,'john','男','ert@dd.com',12);

	3、结束事务

```java
SHOW VARIABLES LIKE '%auto%'

#演示事务的使用步骤

#1、取消事务自动开启
SET autocommit = 0;

#2、开启事务
START TRANSACTION;

#3、编写事务的sql语句

#将张三丰的钱-5000
UPDATE stuinfo SET balance=balance-5000 WHERE stuid = 1;

#将灭绝的钱+5000
UPDATE stuinfo SET balance=balance+5000 WHERE stuid = 2;


#4、结束事务

#提交
#commit;

#### 注意：特别注意：回滚是运行错误了，直接返回运行前的结果，commit与rollback只能运行一个，不可以同时运行

#回滚
ROLLBACK;

SELECT * FROM stuinfo;
```