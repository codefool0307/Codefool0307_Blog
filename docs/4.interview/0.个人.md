
## 1.个人介绍

面试官，你好，目前是我是就职于好未来学而思网校的移动研发部，

目前主要是网校录直播的业务线，
以往的录播直播不支持一对多、而且无法进行互动，
目前就是要补齐与直播中一样的体验效果，引入多对多、一对多等等直播的玩法和互动

目前主要是用事先录好的视频在服务端进行RTMP推流，
每个学生拉RTMP流，学生之间分组进行PK式教学（类似于小组课），同组学生之间通过RTC进行音视频互动。

目前我主要是负责两点：1.学习中心的页面重构，主要包括筛选栏重构、某一功能的设计
                  1.目前使用ffmpeg+soundtouch实现音频解码，然后进行变调变速处理
                  2.由于RTMP视频里回声问题

# 如何实现

1. 目前是做了一个ffmpeg工具类，保存多媒体文件所需的解码信息
2. 将解码后的音频保存位wav文件

## 为什么要保存为wav文件



1、处理摄像头隐私回归BUG
①3v3 1V6在陪写切主讲时RTC状态错误
②1V1单人上台情况下RTC状态同步问题
③1V1单人上台监课提示适配

# 回声问题

RTMP视频流里的课件声音从麦克风回采进入RTC链路，
学生端先听到RTMP传来的课件声音，后听到RTC链路传来的课件回采声音，所以产生回声。老师端也类似。

# RTMP与http协议的优势

http是是本地播放，RTSP是服务器实时播放

1. 用HTTP方式：先通过IIS 将FLV下载到本地缓存，
              然后再通过NetConnection的本地连接来播放这个FLV，
              这种方法是播放本地的视频，并不是播放服务器的视频。
              因此在本地缓存里可以找到这个FLV。
              其优点就是服务器下载完这个FLV，服务器就没有消耗了，
              节省服务器消耗。
              其缺点就是FLV会缓存在客户端，对FLV的保密性不好。

2. 用RTMP方式：通过NetConnection连接到FMS/Red5服务器，并实时播放服务器的FLV文件，
              这种方式可以任意选择视频播放点（SEEK()），
              并不象HTTP方式需要缓存完整个FLV文件到本地才可以任意选择播放点，
              其优点就是在本地缓存里是找不到这个FLV文件的。
              不会缓存在客户端，保密性好，其缺点就是消耗服务器资源，连接始终是实时的。

# RTC与RTMP区别

1. RTMP （Real Time Messaging Protocol）基于 TCP 的流媒体传输协议，最大的特点是与 CDN 的强绑定，
   需要借助 CDN 的负载均衡系统将内容推送到接近用户的边缘节点，使用户就近取得所需内容，提高用户访问的响应速度和成功率，
   解决因分布、带宽、服务器性能带来的访问延迟问题。更多适用于站点加速、点播、短视频等场景。


# 为什么要重构？

由于当前直播结构较乱、插件间耦合严重，无法做到真正的插拔和与其他事业部共建，
主要痛点是
 1. 页面跳转各种方式统一。
      1schema  2 反射 3 各种if逻辑判断。 4 魔鬼数据

 2. onevent事件管理混乱 。
      eg ：其他模块触发的直播提醒请求。 课上跳讲词详情 触发的 学习中心 ，讲词列表的刷新等等

 3 没有前后台概念，各种定时刷新接口逻辑混乱。
                 eg ：开课前十分钟刷新 ， 定时10分钟刷新 ， 切前台 或tab刷新
                      课上回来 直接刷新 讲次详情， 讲次列表 ，课程列表。

                      页面不可见就能发一些网络事件 和页面跳转

 4   逻辑类和UI高度耦合，维护成本较高。
                eg ：  fragment 及 listview presenter 混用

 5  ui状态 和网络事件耦合造成一些 bug。
               eg ：  刷新时 静默loading和带ui loading 没有做区别 各种状态字段乱用 。 refresh接口更新字段不统一

 6 页面埋事件错误需要校准。
              页面pv多报

针对与这些问题提出了重构方案

# 重构的原则

1.避免一个函数的代码量太大，太大要抽取，同时变量要详细描述其功能，尽量避免使用注释去解释功能

2.保证类的单一原则，即一个类只有个功能不要将本属于其他类的逻辑写到本类里面

3.类保证开放封闭原则，即外界的类不能修改本类内部逻辑，
  只能调用封装好的函数，不能调用其变量，只能本类去修改，
  对于类中的变量不能直接访问修改要通过函数修改，
  目的就是为了降低耦合度，防止改一处代码，其他都要改，
  封装就是进行了代码隔离以及复用，封装可以容易理解

4.消除重复代码

5.重构不能忽视性能

# 重构对于你的印象

1. 
2. 由于最初UI控件选择不当的原因（UITableView+UICollectionView），导致写了一

堆奇奇怪怪的代码出来，造成了后期代码极难维护

但无论怎么，到这里UI是搭建起来了（先run起来再说，优不优雅不重要），那现在就涉及到业务逻辑了。

其实主要业务逻辑就是把外露筛选、外露按钮、外露筛选展开、主筛选模块几个模块串起来即可，

